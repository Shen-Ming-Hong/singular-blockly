# ä¾è³´å‡ç´šè¦æ ¼

> æ•´åˆè‡ª specs/005-009ï¼ˆå®‰å…¨ä¾è³´æ›´æ–°ç³»åˆ—ï¼‰

## æ¦‚è¿°

**ç›®æ¨™**ï¼šé€éäº”éšæ®µæ¼¸é€²å¼å‡ç´šç­–ç•¥ï¼Œå°‡å°ˆæ¡ˆä¾è³´ç¾ä»£åŒ–

**ç‹€æ…‹**ï¼šâœ… å®Œæˆ

---

## å‡ç´šç­–ç•¥

æ¡ç”¨äº”éšæ®µæ¼¸é€²å¼å‡ç´šï¼Œä¾é¢¨éšªç­‰ç´šæ’åºï¼š

| éšæ®µ | è¦æ ¼ | é¢¨éšª | æè¿°                                 |
| ---- | ---- | ---- | ------------------------------------ |
| 1    | 005  | ä½   | å®‰å…¨ä¾è³´æ›´æ–°ï¼ˆTypeScriptã€æ¸¬è©¦æ¡†æ¶ï¼‰ |
| 2    | 006  | ä½   | æ¬¡è¦ä¾è³´æ›´æ–°ï¼ˆthemeã€typesï¼‰         |
| 3    | 007  | ä¸­   | å‹åˆ¥å®šç¾©å‡ç´šï¼ˆVSCodeã€Node.jsï¼‰      |
| 4    | 008  | é«˜   | æ ¸å¿ƒä¾è³´å‡ç´šï¼ˆBlockly 12ï¼‰           |
| 5    | 009  | ä¸­   | é–‹ç™¼å·¥å…·å‡ç´šï¼ˆESLintã€webpack-cliï¼‰  |

---

## Phase 1ï¼šå®‰å…¨ä¾è³´æ›´æ–°ï¼ˆ005ï¼‰

### å‡ç´šå…§å®¹

| å¥—ä»¶                  | ä¹‹å‰   | ä¹‹å¾Œ    | é¢¨éšª |
| --------------------- | ------ | ------- | ---- |
| typescript            | 5.7.2  | 5.9.3   | ä½   |
| @typescript-eslint/\* | 8.19.1 | 8.46.1  | ä½   |
| sinon                 | 20     | 21      | ä½   |
| webpack               | 5.97.1 | 5.102.1 | ä½   |
| @vscode/test-electron | 2.4.1  | 2.5.2   | ä½   |

### æˆåŠŸæ¨™æº–

-   âœ… 190 æ¸¬è©¦å…¨éƒ¨é€šé
-   âœ… è¦†è“‹ç‡ç¶­æŒ 87.21%+
-   âœ… ç·¨è­¯æ™‚é–“ â‰¤ 5s

---

## Phase 2ï¼šæ¬¡è¦ä¾è³´æ›´æ–°ï¼ˆ006ï¼‰

### å‡ç´šå…§å®¹

| å¥—ä»¶                  | ä¹‹å‰     | ä¹‹å¾Œ     | èªªæ˜             |
| --------------------- | -------- | -------- | ---------------- |
| @blockly/theme-modern | 6.0.10   | 6.0.12   | ä¸»é¡Œ bug ä¿®å¾©    |
| @types/node           | 20.17.12 | 20.19.22 | Node.js å‹åˆ¥ä¿®æ­£ |

### é©—è­‰é‡é»

-   ä¸»é¡Œè¦–è¦ºå¤–è§€
-   Node.js API å‹åˆ¥æº–ç¢ºæ€§

---

## Phase 3ï¼šå‹åˆ¥å®šç¾©å‡ç´šï¼ˆ007ï¼‰

### å‡ç´šå…§å®¹

| å¥—ä»¶            | ä¹‹å‰   | ä¹‹å¾Œ    | å½±éŸ¿                   |
| --------------- | ------ | ------- | ---------------------- |
| @types/vscode   | 1.96.0 | 1.105.0 | **é—œéµï¼šMCP API æ”¯æ´** |
| @types/node     | 20.x   | 22.x    | ES2023 ç‰¹æ€§            |
| tsconfig target | ES2022 | ES2023  | æ–°èªæ³•æ”¯æ´             |

### é—œéµè®Šæ›´

`@types/vscode` 1.105.0 æ–°å¢ï¼š

-   `registerMcpServerDefinitionProvider` API
-   MCP Server æ•´åˆæ‰€éœ€å‹åˆ¥

---

## Phase 4ï¼šæ ¸å¿ƒä¾è³´å‡ç´šï¼ˆ008ï¼‰ğŸ”´ é«˜é¢¨éšª

### å‡ç´šå…§å®¹

| å¥—ä»¶                  | ä¹‹å‰   | ä¹‹å¾Œ   | ç ´å£æ€§è®Šæ›´ |
| --------------------- | ------ | ------ | ---------- |
| blockly               | 11.2.2 | 12.3.1 | **æ˜¯**     |
| @blockly/theme-modern | 6.0.12 | 7.0.1  | æ˜¯         |

### Blockly 12 ç ´å£æ€§è®Šæ›´

#### 1. åºåˆ—åŒ–ç³»çµ±

**è®Šæ›´**ï¼šJSON åºåˆ—åŒ–å„ªå…ˆæ–¼ XML

**å½±éŸ¿**ï¼š

-   æœ‰ mutation çš„ç©æœ¨éœ€æ–°å¢ `saveExtraState` / `loadExtraState`
-   è§¸ç™¼ 014 åºåˆ—åŒ–ä¿®å¾©

**è§£æ±ºæ–¹æ¡ˆ**ï¼š

```javascript
// åŒæ™‚å¯¦ä½œå…©ç¨® hooks
Blockly.Blocks['encoder_setup'] = {
	// JSON åºåˆ—åŒ–ï¼ˆBlockly 12 å„ªå…ˆä½¿ç”¨ï¼‰
	saveExtraState: function () {
		return { encoder: this.getFieldValue('ENCODER') };
	},
	loadExtraState: function (state) {
		this.setFieldValue(state.encoder, 'ENCODER');
	},

	// XML åºåˆ—åŒ–ï¼ˆå‘å¾Œç›¸å®¹ï¼‰
	mutationToDom: function () {
		/* ... */
	},
	domToMutation: function (xml) {
		/* ... */
	},
};
```

#### 2. ä¸»é¡Œç³»çµ±

**è®Šæ›´**ï¼š@blockly/theme-modern 7.0.1 é…åˆ Blockly 12

**é©—è­‰**ï¼š

-   Light/Dark ä¸»é¡Œåˆ‡æ›
-   ç©æœ¨é¡è‰²ä¸€è‡´æ€§
-   æ–‡å­—å¯è®€æ€§

#### 3. å·¥ä½œå€ç›¸å®¹æ€§

**éœ€æ±‚**ï¼šBlockly 11 çš„ `main.json` å¿…é ˆèƒ½è¼‰å…¥

**æ¸¬è©¦**ï¼š

```typescript
test('æ‡‰è¼‰å…¥ Blockly 11 æ ¼å¼çš„ main.json', async () => {
	const oldFormat = loadFixture('blockly-11-workspace.json');
	const workspace = Blockly.serialization.workspaces.load(oldFormat);
	assert.ok(workspace);
});
```

---

## Phase 5ï¼šé–‹ç™¼å·¥å…·å‡ç´šï¼ˆ009ï¼‰

### å‡ç´šå…§å®¹

| å¥—ä»¶                             | ä¹‹å‰   | ä¹‹å¾Œ   | èªªæ˜           |
| -------------------------------- | ------ | ------ | -------------- |
| @typescript-eslint/eslint-plugin | 8.46.1 | 8.46.2 | Patch ä¿®å¾©     |
| ESLint ecmaVersion               | 2022   | 2023   | é…åˆ tsconfig  |
| webpack-cli                      | 5.1.4  | 6.0.1  | **Major ç‰ˆæœ¬** |

### webpack-cli 6.x æ³¨æ„äº‹é …

-   ç¢ºèªå‘½ä»¤åˆ—åƒæ•¸ç›¸å®¹
-   é©—è­‰ `npm run compile` æ­£å¸¸åŸ·è¡Œ

---

## å‡ç´šæµç¨‹ SOP

### æ¯æ¬¡å‡ç´šå‰

1. å»ºç«‹åŠŸèƒ½åˆ†æ”¯
2. å‚™ä»½ `package-lock.json`
3. è¨˜éŒ„ç•¶å‰æ¸¬è©¦ç‹€æ…‹

### å‡ç´šæ­¥é©Ÿ

```powershell
# 1. æ›´æ–°å¥—ä»¶
npm update <package-name>

# 2. ç·¨è­¯é©—è­‰
npm run compile

# 3. åŸ·è¡Œæ¸¬è©¦
npm test

# 4. æ‰‹å‹•é©—è­‰
# - é–‹å•Ÿç·¨è¼¯å™¨
# - æ‹–æ›³ç©æœ¨
# - æª¢æŸ¥ç¨‹å¼ç¢¼ç”Ÿæˆ
```

### å‡ç´šå¾Œ

1. æ›´æ–° CHANGELOG
2. æäº¤ PR
3. ç­‰å¾… CI é€šé

---

## ç‰ˆæœ¬å°ç…§è¡¨

### å‡ç´šå‰ï¼ˆv1.xï¼‰

```json
{
	"devDependencies": {
		"typescript": "5.7.2",
		"@types/vscode": "1.96.0",
		"@types/node": "20.17.12",
		"blockly": "11.2.2",
		"@blockly/theme-modern": "6.0.10",
		"webpack": "5.97.1",
		"webpack-cli": "5.1.4"
	}
}
```

### å‡ç´šå¾Œï¼ˆv2.0ï¼‰

```json
{
	"devDependencies": {
		"typescript": "5.9.3",
		"@types/vscode": "1.105.0",
		"@types/node": "22.x",
		"blockly": "12.3.1",
		"@blockly/theme-modern": "7.0.1",
		"webpack": "5.102.1",
		"webpack-cli": "6.0.1"
	}
}
```

---

## ç¶“é©—æ•™è¨“

### æˆåŠŸå¯¦è¸

1. **æ¼¸é€²å¼å‡ç´š**ï¼šé¿å…ä¸€æ¬¡æ€§å¤§é‡è®Šæ›´
2. **é¢¨éšªæ’åº**ï¼šå…ˆä½é¢¨éšªï¼Œå¾Œé«˜é¢¨éšª
3. **æŒçºŒæ¸¬è©¦**ï¼šæ¯éšæ®µéƒ½åŸ·è¡Œå®Œæ•´æ¸¬è©¦

### è¸©å‘è¨˜éŒ„

1. **Blockly åºåˆ—åŒ–**ï¼šå‡ç´š 12.x å¾Œæ‰ç™¼ç¾ mutation ç©æœ¨å•é¡Œ
    - æ•™è¨“ï¼šä¸»è¦ç‰ˆæœ¬å‡ç´šå‰æ‡‰è©³è®€ changelog
2. **å‹åˆ¥ä¸ç›¸å®¹**ï¼š@types/node 22.x èˆ‡æŸäº›èˆŠ API
    - æ•™è¨“ï¼šå‹åˆ¥å‡ç´šéœ€åŒæ­¥æ›´æ–°ä½¿ç”¨æ–¹å¼

---

## ç›¸é—œæ–‡ä»¶

-   package.jsonï¼š`package.json`
-   TypeScript é…ç½®ï¼š`tsconfig.json`
