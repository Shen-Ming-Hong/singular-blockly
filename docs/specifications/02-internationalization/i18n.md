# 國際化（i18n）規格

> 整合自 specs/002-i18n-localization-review

## 概述

**目標**：建立自動化翻譯品質驗證系統，確保 15 種語言的翻譯一致性

**狀態**：✅ Phase 1 完成（GitHub Issue #16 已關閉）

---

## 支援語言

| 代碼    | 語言           | 覆蓋率 |
| ------- | -------------- | ------ |
| en      | English        | 100%   |
| es      | Español        | ~99%   |
| pt-br   | Português (BR) | ~99%   |
| fr      | Français       | ~99%   |
| de      | Deutsch        | ~99%   |
| it      | Italiano       | ~99%   |
| ru      | Русский        | ~99%   |
| ja      | 日本語         | ~99%   |
| ko      | 한국어         | ~99%   |
| zh-hant | 繁體中文       | 100%   |
| pl      | Polski         | ~99%   |
| hu      | Magyar         | ~99%   |
| tr      | Türkçe         | ~99%   |
| bg      | Български      | ~99%   |
| cs      | Čeština        | ~99%   |

**平均覆蓋率**：98.94%

---

## 白名單機制

### 問題背景

自動翻譯審計工具產生大量誤報（假陽性），影響實際問題的識別。

### 解決方案

實作基於規則的白名單過濾系統，將高嚴重性誤報從 61 件降至 0 件（68.9% 減少）。

### 白名單規則類型

```javascript
// scripts/i18n/audit-whitelist.json
{
  "rules": [
    {
      "type": "KEYWORD_TECHNICAL",
      "pattern": "PWM|I2C|SPI|UART|GPIO|WiFi|MQTT",
      "reason": "技術術語應保持原文"
    },
    {
      "type": "KEYWORD_HARDWARE",
      "pattern": "HuskyLens|Pixetto|ESP32|Arduino",
      "reason": "硬體品牌名稱不翻譯"
    },
    {
      "type": "MEASUREMENT_PATTERN",
      "pattern": "\\d+\\s*(Hz|KHz|MHz|ms|bit)",
      "reason": "測量單位保持英文"
    },
    {
      "type": "CONSISTENT_TRANSLATION",
      "pattern": "setup|loop|Serial",
      "reason": "Arduino 術語跨語言一致"
    }
  ]
}
```

### 16 條驗證規則

1. 缺失翻譯檢查
2. 佔位符一致性 `{0}`, `%s`
3. 編碼驗證（UTF-8）
4. 術語一致性
5. 長度比例檢查
6. HTML 標籤保留
7. 數字格式保留
8. 標點符號適當轉換
9. 品牌名稱保留
10. 快捷鍵保留
11. 檔案路徑保留
12. 程式碼片段保留
13. URL 保留
14. emoji 保留
15. 特殊字元跳脫
16. 大小寫敏感術語

---

## 訊息檔案結構

### 位置

```
media/locales/
├── en/messages.js      # 英文（基準）
├── zh-hant/messages.js # 繁體中文
├── ja/messages.js      # 日文
└── ...
```

### 格式

```javascript
// media/locales/zh-hant/messages.js
Blockly.Msg['HUSKYLENS_INIT_I2C'] = '初始化 HuskyLens (I2C)';
Blockly.Msg['HUSKYLENS_INIT_I2C_TOOLTIP'] = '使用 I2C 通訊初始化 HuskyLens 智慧鏡頭\n' + '接線提示：{0}';
```

### 使用方式

```javascript
// WebView (blocklyEdit.js)
window.languageManager.getMessage('HUSKYLENS_INIT_I2C', '預設文字');

// Extension (localeService.ts)
localeService.getLocalizedMessage('HUSKYLENS_INIT_I2C', defaultText);
```

---

## 驗證工具

### 可用指令

```powershell
# 驗證翻譯品質
npm run validate:i18n

# 審計所有語言
npm run audit:i18n:all

# 生成覆蓋率統計
npm run stats:i18n

# 驗證 HuskyLens 特定翻譯
npm run validate:huskylens
```

### CI/CD 整合

```yaml
# .github/workflows/i18n-audit.yml
name: Monthly i18n Audit
on:
    schedule:
        - cron: '0 0 1 * *' # 每月 1 日
jobs:
    audit:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - run: npm run audit:i18n:all
```

---

## 新增翻譯指南

### 1. 新增訊息鍵

```javascript
// 1. 先在英文檔案新增
// media/locales/en/messages.js
Blockly.Msg['NEW_FEATURE_LABEL'] = 'New Feature';
Blockly.Msg['NEW_FEATURE_TOOLTIP'] = 'Description of the feature';

// 2. 在所有語言檔案新增翻譯
// media/locales/zh-hant/messages.js
Blockly.Msg['NEW_FEATURE_LABEL'] = '新功能';
Blockly.Msg['NEW_FEATURE_TOOLTIP'] = '功能描述';
```

### 2. 命名慣例

| 後綴          | 用途       | 範例                   |
| ------------- | ---------- | ---------------------- |
| `_LABEL`      | UI 標籤    | `SERVO_SETUP_LABEL`    |
| `_TOOLTIP`    | 提示文字   | `SERVO_SETUP_TOOLTIP`  |
| `_DROPDOWN_*` | 下拉選項   | `SERVO_DROPDOWN_ANGLE` |
| `_ERROR_*`    | 錯誤訊息   | `SERVO_ERROR_INVALID`  |
| `_COMMENT_*`  | 程式碼註解 | `SERVO_COMMENT_INIT`   |

### 3. 佔位符

```javascript
// 使用 {0}, {1} 格式
Blockly.Msg['PIN_TOOLTIP'] = '腳位 {0} 設定為 {1}';

// 呼叫時傳入參數
getMessage('PIN_TOOLTIP').replace('{0}', pin).replace('{1}', mode);
```

---

## 測試要求

-   最小測試範圍：EN + ZH-HANT
-   新功能必須包含所有 15 種語言翻譯
-   使用 `npm run validate:i18n` 確認無遺漏

---

## 相關文件

-   白名單設定：`scripts/i18n/audit-whitelist.json`
-   驗證腳本：`scripts/i18n/validate-translations.js`
-   審計腳本：`scripts/i18n/audit-translations.js`
