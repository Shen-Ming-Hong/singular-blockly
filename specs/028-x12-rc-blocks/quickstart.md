# 快速入門: CyberBrick X12 與 RC 遙控積木

**功能分支**: `028-x12-rc-blocks`

---

## 概述

此功能為 CyberBrick 新增兩個選單：

-   **RC 遙控選單** (藍綠色) - 無線遙控通訊功能
-   **X12 發射端選單** (綠色) - 發射端本機搖桿/按鈕讀取

---

## 使用情境

### 情境 1: 基本遙控車 (最常見)

**發射端 (遙控器 + X12 擴展板)**:

```
不需要寫程式，遙控器自動傳送資料
```

**接收端 (遙控車)**:

```blocks
[rc_slave_init]
[forever loop]
  ├─ [x11_motor_speed M1] ← [rc_get_joystick_mapped L2 -100 100]
  └─ [x11_motor_speed M2] ← [rc_get_joystick_mapped R2 -100 100]
```

### 情境 2: 進階遙控器 (發射端自訂邏輯)

**發射端 (遙控器 + X12 擴展板)**:

```blocks
[rc_master_init]
[forever loop]
  └─ [print] ← [x12_get_joystick L1]  # 顯示本機搖桿值
```

**接收端 (遙控車)**:

```blocks
[rc_slave_init]
[forever loop]
  └─ [x11_motor_speed M1] ← [rc_get_joystick L1]
```

### 情境 3: 斷線處理

```blocks
[rc_slave_init]
[forever loop]
  ├─ [if] [rc_is_connected]
  │   └─ [x11_motor_speed M1] ← [rc_get_joystick_mapped L2 -100 100]
  └─ [else]
      └─ [x11_motor_stop M1]  # 斷線時停止馬達
```

---

## 積木清單

### RC 選單 (接收端/發射端通用)

| 積木                                    | 功能                    | 使用時機             |
| --------------------------------------- | ----------------------- | -------------------- |
| 🟢 `初始化發射端 (Master)`              | 初始化發射模式          | 發射端程式開頭       |
| 🟢 `初始化接收端 (Slave)`               | 初始化接收模式          | 接收端程式開頭       |
| 🔵 `遠端搖桿 [通道]`                    | 讀取遠端搖桿值 (0-4095) | 接收端讀取發射端搖桿 |
| 🔵 `遠端搖桿 [通道] 映射 [min] ~ [max]` | 讀取並映射遠端搖桿      | 接收端控制馬達       |
| 🟡 `遠端按鈕 [通道] 被按下?`            | 檢查遠端按鈕 (布林)     | 接收端判斷按鈕       |
| 🟡 `遠端按鈕 [通道] 狀態`               | 讀取遠端按鈕狀態 (0/1)  | 接收端讀取原始狀態   |
| 🟣 `已連線?`                            | 檢查無線連線狀態        | 斷線處理邏輯         |
| 🟣 `配對索引`                           | 取得配對編號 (0/1/2)    | 多機配對識別         |

### X12 選單 (僅發射端)

| 積木                                    | 功能                 | 使用時機       |
| --------------------------------------- | -------------------- | -------------- |
| 🔵 `本機搖桿 [通道]`                    | 讀取發射端本機搖桿值 | 發射端自訂邏輯 |
| 🔵 `本機搖桿 [通道] 映射 [min] ~ [max]` | 讀取並映射本機搖桿   | 發射端數值映射 |
| 🟡 `本機按鈕 [通道] 被按下?`            | 檢查發射端按鈕       | 發射端按鈕偵測 |
| 🟡 `本機按鈕 [通道] 狀態`               | 讀取發射端按鈕狀態   | 發射端狀態讀取 |

---

## 通道對照表

### 搖桿通道

| 通道 | 說明         | 典型用途   |
| ---- | ------------ | ---------- |
| L1   | 左搖桿 X 軸  | 左右轉向   |
| L2   | 左搖桿 Y 軸  | 前進後退   |
| L3   | 左搖桿第三軸 | 旋鈕/按壓  |
| R1   | 右搖桿 X 軸  | 機械臂旋轉 |
| R2   | 右搖桿 Y 軸  | 機械臂升降 |
| R3   | 右搖桿第三軸 | 旋鈕/按壓  |

### 按鈕通道

| 通道 | 說明   | 典型用途  |
| ---- | ------ | --------- |
| K1   | 按鈕 1 | 啟動/停止 |
| K2   | 按鈕 2 | 模式切換  |
| K3   | 按鈕 3 | 功能 A    |
| K4   | 按鈕 4 | 功能 B    |

---

## 開發步驟

### 新增積木 (開發者)

1. **積木定義**: `media/blockly/blocks/rc.js` 和 `x12.js`
2. **程式碼生成**: `media/blockly/generators/micropython/rc.js` 和 `x12.js`
3. **Toolbox 配置**: `media/toolbox/categories/cyberbrick_rc.json` 和 `cyberbrick_x12.json`
4. **主 Toolbox**: 修改 `media/toolbox/cyberbrick.json` 引入新選單
5. **HTML 載入**: 修改 `media/html/blocklyEdit.html` 載入新 JS 檔案
6. **i18n**: 更新所有 15 種語言的 `messages.js`

### 測試檢查清單

-   [ ] 發射端初始化後可讀取本機搖桿
-   [ ] 接收端初始化後可讀取遠端搖桿
-   [ ] 映射積木正確轉換數值範圍
-   [ ] 未連線時使用安全預設值
-   [ ] 所有積木在 15 種語言下正確顯示

---

## 常見問題

### Q: X12 和 RC 有什麼區別？

**X12** 是讀取發射端「本機」硬體的搖桿/按鈕值，用於在遙控器上做自訂邏輯。

**RC** 是處理「無線通訊」，讓接收端讀取來自發射端的資料。

### Q: 為什麼搖桿中點是 2048 而不是 0？

CyberBrick 使用 12-bit ADC (0-4095)，中點為 2048。使用映射積木可轉換為 -100~100 等常見範圍。

### Q: 按鈕狀態為什麼是 0=按下、1=放開？

這是硬體設計的上拉電阻邏輯。使用 `被按下?` 積木會自動轉換為正確的布林值 (True=按下)。
