{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "RC 遙控積木定義",
    "description": "CyberBrick RC 無線遙控通訊選單的積木 API 合約",
    "version": "1.0.0",
    "menuConfig": {
        "category": "CATEGORY_RC",
        "colour": 160,
        "labels": [
            "RC_LABEL_INIT",
            "RC_LABEL_JOYSTICK",
            "RC_LABEL_BUTTON",
            "RC_LABEL_STATUS"
        ]
    },
    "sharedOptions": {
        "joystickChannels": [
            {
                "label": "L1",
                "value": "0"
            },
            {
                "label": "L2",
                "value": "1"
            },
            {
                "label": "L3",
                "value": "2"
            },
            {
                "label": "R1",
                "value": "3"
            },
            {
                "label": "R2",
                "value": "4"
            },
            {
                "label": "R3",
                "value": "5"
            }
        ],
        "buttonChannels": [
            {
                "label": "K1",
                "value": "6"
            },
            {
                "label": "K2",
                "value": "7"
            },
            {
                "label": "K3",
                "value": "8"
            },
            {
                "label": "K4",
                "value": "9"
            }
        ]
    },
    "blocks": [
        {
            "type": "rc_master_init",
            "category": "init",
            "message": "%{RC_MASTER_INIT}",
            "tooltip": "%{RC_MASTER_INIT_TOOLTIP}",
            "output": null,
            "previousStatement": true,
            "nextStatement": true,
            "codeTemplate": {
                "micropython": {
                    "imports": [
                        "import rc_module"
                    ],
                    "hardwareInit": [],
                    "code": "rc_module.rc_master_init()\n"
                }
            }
        },
        {
            "type": "rc_slave_init",
            "category": "init",
            "message": "%{RC_SLAVE_INIT}",
            "tooltip": "%{RC_SLAVE_INIT_TOOLTIP}",
            "output": null,
            "previousStatement": true,
            "nextStatement": true,
            "codeTemplate": {
                "micropython": {
                    "imports": [
                        "import rc_module"
                    ],
                    "hardwareInit": [],
                    "code": "rc_module.rc_slave_init()\n"
                }
            }
        },
        {
            "type": "rc_get_joystick",
            "category": "joystick",
            "message": "%{RC_GET_JOYSTICK_PREFIX} %1",
            "args": [
                {
                    "type": "field_dropdown",
                    "name": "CHANNEL",
                    "options": "$ref:sharedOptions.joystickChannels"
                }
            ],
            "tooltip": "%{RC_GET_JOYSTICK_TOOLTIP}",
            "output": "Number",
            "codeTemplate": {
                "micropython": {
                    "imports": [
                        "import rc_module"
                    ],
                    "hardwareInit": [],
                    "code": "(rc_module.rc_slave_data() or (2048,)*10)[{CHANNEL}]",
                    "order": "ORDER_MEMBER"
                }
            }
        },
        {
            "type": "rc_get_joystick_mapped",
            "category": "joystick",
            "message": "%{RC_GET_JOYSTICK_MAPPED_PREFIX} %1 %{RC_GET_JOYSTICK_MAPPED_MIN} %2 %{RC_GET_JOYSTICK_MAPPED_MAX} %3",
            "args": [
                {
                    "type": "field_dropdown",
                    "name": "CHANNEL",
                    "options": "$ref:sharedOptions.joystickChannels"
                },
                {
                    "type": "input_value",
                    "name": "MIN",
                    "check": "Number",
                    "shadow": {
                        "type": "math_number",
                        "fields": {
                            "NUM": -100
                        }
                    }
                },
                {
                    "type": "input_value",
                    "name": "MAX",
                    "check": "Number",
                    "shadow": {
                        "type": "math_number",
                        "fields": {
                            "NUM": 100
                        }
                    }
                }
            ],
            "tooltip": "%{RC_GET_JOYSTICK_MAPPED_TOOLTIP}",
            "output": "Number",
            "inputsInline": true,
            "codeTemplate": {
                "micropython": {
                    "imports": [
                        "import rc_module"
                    ],
                    "hardwareInit": [],
                    "code": "((rc_module.rc_slave_data() or (2048,)*10)[{CHANNEL}] * ({MAX} - {MIN}) // 4095 + {MIN})",
                    "order": "ORDER_ADDITIVE"
                }
            }
        },
        {
            "type": "rc_is_button_pressed",
            "category": "button",
            "message": "%{RC_IS_BUTTON_PRESSED_PREFIX} %1 %{RC_IS_BUTTON_PRESSED_SUFFIX}",
            "args": [
                {
                    "type": "field_dropdown",
                    "name": "BUTTON",
                    "options": "$ref:sharedOptions.buttonChannels"
                }
            ],
            "tooltip": "%{RC_IS_BUTTON_PRESSED_TOOLTIP}",
            "output": "Boolean",
            "codeTemplate": {
                "micropython": {
                    "imports": [
                        "import rc_module"
                    ],
                    "hardwareInit": [],
                    "code": "((rc_module.rc_slave_data() or (2048,)*6 + (1,)*4)[{BUTTON}] == 0)",
                    "order": "ORDER_RELATIONAL"
                }
            }
        },
        {
            "type": "rc_get_button",
            "category": "button",
            "message": "%{RC_GET_BUTTON_PREFIX} %1 %{RC_GET_BUTTON_SUFFIX}",
            "args": [
                {
                    "type": "field_dropdown",
                    "name": "BUTTON",
                    "options": "$ref:sharedOptions.buttonChannels"
                }
            ],
            "tooltip": "%{RC_GET_BUTTON_TOOLTIP}",
            "output": "Number",
            "codeTemplate": {
                "micropython": {
                    "imports": [
                        "import rc_module"
                    ],
                    "hardwareInit": [],
                    "code": "(rc_module.rc_slave_data() or (2048,)*6 + (1,)*4)[{BUTTON}]",
                    "order": "ORDER_MEMBER"
                }
            }
        },
        {
            "type": "rc_is_connected",
            "category": "status",
            "message": "%{RC_IS_CONNECTED}",
            "tooltip": "%{RC_IS_CONNECTED_TOOLTIP}",
            "output": "Boolean",
            "codeTemplate": {
                "micropython": {
                    "imports": [
                        "import rc_module"
                    ],
                    "hardwareInit": [],
                    "code": "(rc_module.rc_slave_data() is not None)",
                    "order": "ORDER_RELATIONAL"
                }
            }
        },
        {
            "type": "rc_get_rc_index",
            "category": "status",
            "message": "%{RC_GET_RC_INDEX}",
            "tooltip": "%{RC_GET_RC_INDEX_TOOLTIP}",
            "output": "Number",
            "codeTemplate": {
                "micropython": {
                    "imports": [
                        "import rc_module"
                    ],
                    "hardwareInit": [],
                    "code": "rc_module.rc_index()",
                    "order": "ORDER_FUNCTION_CALL"
                }
            }
        }
    ]
}