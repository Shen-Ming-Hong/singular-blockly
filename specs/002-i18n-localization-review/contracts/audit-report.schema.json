{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://singular-blockly.github.io/schemas/audit-report.schema.json",
    "title": "Translation Audit Report",
    "description": "Schema for translation quality audit report output from audit tools",
    "type": "object",
    "required": [
        "reportId",
        "generatedAt",
        "auditScope",
        "totalIssues",
        "issuesBySeverity",
        "issuesPerLanguage",
        "issues",
        "coverageStats"
    ],
    "properties": {
        "reportId": {
            "type": "string",
            "description": "Unique identifier for this audit report",
            "pattern": "^audit-[0-9]{4}-[0-9]{2}-[0-9]{2}-.+$",
            "examples": [
                "audit-2025-10-17-baseline",
                "audit-2025-10-25-post-fixes"
            ]
        },
        "generatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "ISO8601 timestamp when report was generated"
        },
        "auditScope": {
            "type": "object",
            "required": [
                "languages",
                "messageKeys",
                "auditMethods"
            ],
            "properties": {
                "languages": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z]{2}(-[a-z]{4})?$"
                    },
                    "description": "Languages included in this audit"
                },
                "messageKeys": {
                    "oneOf": [
                        {
                            "type": "string",
                            "enum": [
                                "all"
                            ]
                        },
                        {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        }
                    ],
                    "description": "Message keys audited - 'all' or specific array of keys"
                },
                "auditMethods": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "enum": [
                            "automated-checks",
                            "native-speaker-review",
                            "user-feedback",
                            "pattern-matching"
                        ]
                    },
                    "description": "Audit methodologies applied"
                }
            }
        },
        "totalIssues": {
            "type": "integer",
            "minimum": 0,
            "description": "Total count of issues across all languages"
        },
        "issuesBySeverity": {
            "type": "object",
            "required": [
                "high",
                "medium",
                "low"
            ],
            "properties": {
                "high": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Count of high-severity issues"
                },
                "medium": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Count of medium-severity issues"
                },
                "low": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Count of low-severity issues"
                }
            }
        },
        "issuesPerLanguage": {
            "type": "object",
            "patternProperties": {
                "^[a-z]{2}(-[a-z]{4})?$": {
                    "type": "integer",
                    "minimum": 0
                }
            },
            "description": "Issue count per language code"
        },
        "highFrequencyIssues": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/TranslationQualityIssue"
            },
            "description": "Top 20 issues sorted by frequency (for prioritization)"
        },
        "issues": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/TranslationQualityIssue"
            },
            "description": "Complete list of all issues found"
        },
        "recommendations": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "description": "Actionable next steps based on audit findings"
        },
        "coverageStats": {
            "type": "object",
            "required": [
                "totalMessageKeys",
                "auditedMessageKeys",
                "coveragePercentage",
                "languagesFullyAudited",
                "languagesPartiallyAudited"
            ],
            "properties": {
                "totalMessageKeys": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "Total translatable strings in system"
                },
                "auditedMessageKeys": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Number of keys reviewed"
                },
                "coveragePercentage": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 100,
                    "description": "(auditedMessageKeys / totalMessageKeys) * 100"
                },
                "languagesFullyAudited": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z]{2}(-[a-z]{4})?$"
                    },
                    "description": "Languages with 100% coverage"
                },
                "languagesPartiallyAudited": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z]{2}(-[a-z]{4})?$"
                    },
                    "description": "Languages with <100% coverage"
                }
            }
        },
        "comparisonToBaseline": {
            "type": [
                "object",
                "null"
            ],
            "properties": {
                "baselineReportId": {
                    "type": "string",
                    "description": "ID of baseline report being compared to"
                },
                "issuesResolved": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Issues from baseline that are now fixed"
                },
                "newIssuesFound": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "New issues not in baseline"
                },
                "qualityImprovement": {
                    "type": "number",
                    "minimum": -100,
                    "maximum": 100,
                    "description": "Percentage improvement (-100 to +100)"
                }
            }
        }
    },
    "definitions": {
        "TranslationQualityIssue": {
            "type": "object",
            "required": [
                "key",
                "language",
                "issueType",
                "severity",
                "currentValue",
                "rationale",
                "frequency"
            ],
            "properties": {
                "key": {
                    "type": "string",
                    "description": "Translation message key (e.g., CATEGORY_LOGIC)"
                },
                "language": {
                    "type": "string",
                    "pattern": "^[a-z]{2}(-[a-z]{4})?$",
                    "description": "ISO 639-1 language code"
                },
                "issueType": {
                    "type": "string",
                    "enum": [
                        "directTranslation",
                        "missingTranslation",
                        "inconsistentTerminology",
                        "culturalMismatch",
                        "lengthOverflow",
                        "grammarError",
                        "toneInconsistency"
                    ],
                    "description": "Category of quality issue"
                },
                "severity": {
                    "type": "string",
                    "enum": [
                        "high",
                        "medium",
                        "low"
                    ],
                    "description": "Impact level"
                },
                "currentValue": {
                    "type": "string",
                    "description": "Existing translation text with the issue"
                },
                "suggestedValue": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Proposed improved translation (null if needs native speaker input)"
                },
                "rationale": {
                    "type": "string",
                    "minLength": 10,
                    "description": "Explanation of why current translation is problematic"
                },
                "frequency": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 100,
                    "description": "Estimated usage frequency (0-100 scale)"
                },
                "detectedBy": {
                    "type": "string",
                    "enum": [
                        "automated",
                        "native-speaker-review",
                        "user-feedback"
                    ],
                    "description": "Detection method"
                },
                "detectedAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Timestamp when issue was identified"
                }
            }
        }
    }
}